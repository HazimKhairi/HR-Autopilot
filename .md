# Add Multi-Agent AI to Your Existing HR System

## ðŸŽ¯ What You Have vs What We'll Add

### You Already Have:
âœ… Prisma database with candidate/employee data  
âœ… Basic HR system (simple design)  
âœ… Database schema set up  

### What We'll Add:
ðŸ¤– **Multi-Agent AI Analysis System**
- Agent 1: Compare candidate with similar staff
- Agent 2: Calculate fair salary recommendation  
- Agent 3: Check internal equity (prevent compression)
- Agent 4: Generate reasoning and report

---

## ðŸ”Œ Integration Strategy

We'll add the AI system **alongside** your existing code without breaking anything.

### Approach:

```
Your Existing System          â†’    Enhanced System
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  
1. Query candidate from DB    â†’   1. Query candidate from DB
2. (Manual salary decision)   â†’   2. âœ¨ AI analyzes & recommends
3. Save offer                 â†’   3. Save offer + AI recommendation
```

---

## ðŸ“ File Structure (What to Add)

```
your-project/
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma (âœ… you have this)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ existing-code/ (âœ… your current code)
â”‚   â””â”€â”€ ai-agents/ (ðŸ†• new folder we'll create)
â”‚       â”œâ”€â”€ ollama-client.ts
â”‚       â”œâ”€â”€ staff-comparison-agent.ts
â”‚       â”œâ”€â”€ salary-recommendation-agent.ts
â”‚       â”œâ”€â”€ equity-checker-agent.ts
â”‚       â””â”€â”€ salary-analyzer.ts (main orchestrator)
```

---

## ðŸš€ Quick Start: 3 Steps to Add AI

### Step 1: Install Dependencies (2 minutes)

```bash
# Just need node-fetch if you don't have it
npm install node-fetch
# or
yarn add node-fetch
```

### Step 2: Add AI Agent Files (Copy & Paste)

I'll give you 4 ready-to-use files to add to your project.

### Step 3: Use in Your Existing Code

Add one function call to analyze candidates with AI.

---

## ðŸ“ Step-by-Step: Adding Each Component

### STEP 1: Create Ollama Client Helper

**Purpose:** Reusable helper to call Ollama API

**File:** `src/ai-agents/ollama-client.ts`

### Prompt for AI Developer:

```
I have an existing Prisma HR system. I want to add AI salary recommendations using Ollama.

Step 1: Create a reusable Ollama client helper.

Create a utility class that:
- Connects to Ollama (http://localhost:11434)
- Has a method to send prompts and get JSON responses
- Handles JSON extraction from LLM responses (removes markdown, etc.)
- Has proper error handling

Requirements:
- Class name: OllamaClient
- Method: async generate(prompt, temperature, maxTokens)
- Method: extractJSON(text) - helper to parse JSON from response
- Use model: llama3.1:8b (configurable)
- Handle cases where LLM returns markdown ```json blocks

Example usage:
const client = new OllamaClient();
const result = await client.generate("Analyze this...", 0.2);
const data = client.extractJSON(result);

File: src/ai-agents/ollama-client.ts
```

---

### STEP 2: Create Staff Comparison Agent

**Purpose:** Find similar employees and calculate stats

**File:** `src/ai-agents/staff-comparison-agent.ts`

### Prompt for AI Developer:

```
Step 2: Create an AI agent that compares candidates with existing staff.

This agent:
- Takes candidate profile
- Takes list of employees from database
- Uses AI to calculate similarity scores
- Returns matched employees with salary statistics

Input:
{
  candidate: {
    yearsExperience: 5,
    skills: ["Python", "React"],
    educationLevel: "BS"
  },
  employees: [
    { name: "Alice", yearsExperience: 5, salary: 105000, skills: ["Python", "Vue"] }
  ]
}

Output:
{
  matches: [
    {
      employeeId: "...",
      name: "Alice",
      similarity: 85,
      salary: 105000,
      reasons: ["Same experience", "50% skill match"]
    }
  ],
  stats: {
    average: 105000,
    median: 105000,
    min: 98000,
    max: 112000
  }
}

Requirements:
- Class: StaffComparisonAgent
- Constructor accepts OllamaClient
- Method: async compare(candidate, employees)
- Use Ollama to analyze skill overlap
- Temperature: 0.2 (consistent)
- Return top matches sorted by similarity

File: src/ai-agents/staff-comparison-agent.ts
```

---

### STEP 3: Create Salary Recommendation Agent

**Purpose:** Calculate fair salary based on comparisons

**File:** `src/ai-agents/salary-recommendation-agent.ts`

### Prompt for AI Developer:

```
Step 3: Create an AI agent that recommends salary amounts.

This agent:
- Takes candidate info
- Takes comparison results from previous agent
- Takes salary band limits
- Uses AI to calculate fair salary recommendation

Input:
{
  candidate: { yearsExperience: 5, educationLevel: "BS" },
  comparisons: { stats: { median: 105000 } },
  salaryBand: { min: 90000, max: 120000 }
}

Output:
{
  minimum: 102000,
  target: 105000,
  maximum: 108000,
  reasoning: [
    "Based on median of similar staff ($105k)",
    "Within salary band limits",
    "No adjustments needed"
  ],
  confidence: 90
}

Requirements:
- Class: SalaryRecommendationAgent
- Constructor accepts OllamaClient
- Method: async recommend(candidate, comparisons, salaryBand)
- Temperature: 0.3
- Must stay within salary band
- Return min/target/max values

File: src/ai-agents/salary-recommendation-agent.ts
```

---

### STEP 4: Create Equity Checker Agent

**Purpose:** Check if recommendation creates salary compression

**File:** `src/ai-agents/equity-checker-agent.ts`

### Prompt for AI Developer:

```
Step 4: Create an AI agent that checks internal equity.

This agent:
- Takes recommended salary
- Takes candidate experience
- Takes all current employees
- Checks if new hire would earn more than existing staff with same/more experience

Input:
{
  recommendedSalary: 105000,
  candidateExperience: 5,
  allEmployees: [
    { name: "Alice", yearsExperience: 5, salary: 105000 },
    { name: "Bob", yearsExperience: 6, salary: 112000 }
  ]
}

Output (if OK):
{
  status: "PASS",
  compressionRisk: "none",
  impactedEmployees: [],
  message: "No equity issues detected"
}

Output (if problem):
{
  status: "WARNING",
  compressionRisk: "medium",
  impactedEmployees: [
    {
      name: "Alice",
      issue: "New hire would match salary with same experience"
    }
  ],
  message: "Potential salary compression with Alice"
}

Requirements:
- Class: EquityCheckerAgent
- Constructor accepts OllamaClient
- Method: async check(recommendedSalary, candidateExp, allEmployees)
- Temperature: 0.1 (very consistent)
- Status: "PASS", "WARNING", or "FAIL"
- Risk: "none", "low", "medium", "high"

File: src/ai-agents/equity-checker-agent.ts
```

---

### STEP 5: Create Main Orchestrator

**Purpose:** Ties all agents together in one easy-to-use class

**File:** `src/ai-agents/salary-analyzer.ts`

### Prompt for AI Developer:

```
Step 5: Create the main orchestrator that uses all agents.

This is the main class that:
1. Uses StaffComparisonAgent to find similar employees
2. Uses SalaryRecommendationAgent to calculate salary
3. Uses EquityCheckerAgent to verify fairness
4. Returns complete analysis

This will be used in the existing HR system.

Requirements:
- Class: SalaryAnalyzer
- Constructor: accepts Prisma client and Ollama URL
- Main method: async analyze(candidateId)

Method flow:
async analyze(candidateId) {
  // 1. Get candidate from database
  const candidate = await prisma.candidate.findUnique({ where: { id: candidateId } });
  
  // 2. Get similar employees (same seniority level, Â±2 years experience)
  const employees = await prisma.employee.findMany({
    where: {
      seniorityLevel: candidate.seniorityLevel,
      yearsExperience: { gte: candidate.yearsExperience - 2, lte: candidate.yearsExperience + 2 }
    }
  });
  
  // 3. Compare with staff
  const comparisons = await comparisonAgent.compare(candidate, employees);
  
  // 4. Get salary band
  const band = await prisma.salaryBand.findFirst({
    where: { seniorityLevel: candidate.seniorityLevel }
  });
  
  // 5. Get recommendation
  const recommendation = await recommendationAgent.recommend(candidate, comparisons, band);
  
  // 6. Check equity
  const allEmployees = await prisma.employee.findMany({ where: { isActive: true } });
  const equity = await equityAgent.check(recommendation.target, candidate.yearsExperience, allEmployees);
  
  // 7. Return everything
  return {
    candidate,
    comparisons,
    recommendation,
    equity
  };
}

Also add method: async saveRecommendation(candidateId, result)
- Saves the recommendation to database for audit trail

File: src/ai-agents/salary-analyzer.ts
```

---

## ðŸ”— How to Use in Your Existing Code

### Before (Your Current Code):

```typescript
// your-existing-route.ts

app.post('/api/analyze-candidate', async (req, res) => {
  const { candidateId } = req.body;
  
  // Get candidate
  const candidate = await prisma.candidate.findUnique({
    where: { id: candidateId }
  });
  
  // Manual decision or simple logic
  const salary = 100000; // ???
  
  res.json({ salary });
});
```

### After (With AI):

```typescript
// your-existing-route.ts

import { SalaryAnalyzer } from './ai-agents/salary-analyzer';

app.post('/api/analyze-candidate', async (req, res) => {
  const { candidateId } = req.body;
  
  // ðŸ†• Use AI analyzer
  const analyzer = new SalaryAnalyzer(prisma);
  const analysis = await analyzer.analyze(candidateId);
  
  res.json({
    candidate: analysis.candidate,
    recommendation: {
      salary: analysis.recommendation.target,
      range: {
        min: analysis.recommendation.minimum,
        max: analysis.recommendation.maximum
      },
      reasoning: analysis.recommendation.reasoning
    },
    comparisons: analysis.comparisons.stats,
    equity: {
      status: analysis.equity.status,
      risk: analysis.equity.compressionRisk
    }
  });
});
```

**That's it!** Just import and use. No changes to your database or existing logic.

---

## ðŸŽ¨ Example: Adding to Your UI

### If You Have a React Component:

```typescript
// CandidateAnalysis.tsx (your existing component)

function CandidateAnalysis({ candidateId }) {
  const [analysis, setAnalysis] = useState(null);
  
  const analyzeSalary = async () => {
    // ðŸ†• Call your API (which now uses AI)
    const res = await fetch(`/api/analyze-candidate`, {
      method: 'POST',
      body: JSON.stringify({ candidateId })
    });
    const data = await res.json();
    setAnalysis(data);
  };
  
  return (
    <div>
      <button onClick={analyzeSalary}>Analyze with AI</button>
      
      {analysis && (
        <div>
          <h3>AI Recommendation</h3>
          <p>Recommended: ${analysis.recommendation.salary.toLocaleString()}</p>
          <p>Range: ${analysis.recommendation.range.min.toLocaleString()} - 
             ${analysis.recommendation.range.max.toLocaleString()}</p>
          
          <h4>Reasoning:</h4>
          <ul>
            {analysis.recommendation.reasoning.map(r => <li>{r}</li>)}
          </ul>
          
          <h4>Equity Check:</h4>
          <p>Status: {analysis.equity.status} âœ“</p>
          <p>Risk: {analysis.equity.risk}</p>
        </div>
      )}
    </div>
  );
}
```

---

## ðŸ“Š What Your Database Needs

### Required Tables (you probably have these):

```prisma
model Candidate {
  id              String @id
  name            String
  yearsExperience Int
  skills          String[]
  educationLevel  String
  seniorityLevel  String
  // ... other fields
}

model Employee {
  id              String @id
  name            String
  yearsExperience Int
  currentSalary   Int
  skills          String[]
  seniorityLevel  String
  isActive        Boolean
  // ... other fields
}

model SalaryBand {
  id             String @id
  seniorityLevel String
  minimumSalary  Int
  maximumSalary  Int
}
```

### Optional: Add Recommendation History Table

```prisma
model SalaryRecommendation {
  id                String   @id @default(uuid())
  candidateId       String
  targetSalary      Int
  minimumSalary     Int
  maximumSalary     Int
  reasoning         String
  equityStatus      String
  compressionRisk   String
  createdAt         DateTime @default(now())
  createdBy         String
}
```

This lets you save AI recommendations for audit trail.

---

## âš¡ Quick Integration Checklist

### Phase 1: Add AI Files (30 minutes)
- [ ] Create `ai-agents/` folder
- [ ] Add ollama-client.ts
- [ ] Add staff-comparison-agent.ts
- [ ] Add salary-recommendation-agent.ts
- [ ] Add equity-checker-agent.ts
- [ ] Add salary-analyzer.ts (main)

### Phase 2: Test Agents (15 minutes)
- [ ] Test each agent independently
- [ ] Verify JSON responses work
- [ ] Check Ollama connection

### Phase 3: Integrate (15 minutes)
- [ ] Import SalaryAnalyzer in your existing code
- [ ] Add one API call: `analyzer.analyze(candidateId)`
- [ ] Update UI to show results

### Phase 4: Optional Enhancements (30 minutes)
- [ ] Add database table for recommendation history
- [ ] Add batch analysis for multiple candidates
- [ ] Add caching for performance

---

## ðŸ”§ Minimal Working Example

Here's the absolute minimum to get started:

```typescript
// test-ai.ts - Quick test script

import { PrismaClient } from '@prisma/client';
import { SalaryAnalyzer } from './ai-agents/salary-analyzer';

async function test() {
  const prisma = new PrismaClient();
  const analyzer = new SalaryAnalyzer(prisma);
  
  // Pick any candidate ID from your database
  const result = await analyzer.analyze("your-candidate-id");
  
  console.log("Recommended Salary:", result.recommendation.target);
  console.log("Reasoning:", result.recommendation.reasoning);
  console.log("Equity Status:", result.equity.status);
  
  await prisma.$disconnect();
}

test();
```

Run: `npx ts-node test-ai.ts`

If this works, your AI system is ready! Just integrate into your existing routes/components.

---

## ðŸŽ¯ Summary

### What You Need to Do:

1. **Copy 5 AI agent files** into your project (I'll provide ready-to-use code)
2. **Import SalaryAnalyzer** in your existing code
3. **Call analyzer.analyze(candidateId)** where you need salary recommendations

### What You Get:

âœ… AI-powered salary recommendations  
âœ… Automatic staff comparisons  
âœ… Equity checking (prevents compression)  
âœ… Clear reasoning for every decision  
âœ… No changes to existing database or logic  

---

## ðŸš€ Ready?

Would you like me to:

1. **Generate the complete ready-to-use agent files** (just copy & paste)?
2. **Show exactly where to add the integration** in your existing code?
3. **Create a minimal working example** you can test immediately?

Let me know and I'll provide the exact code! ðŸŽ‰